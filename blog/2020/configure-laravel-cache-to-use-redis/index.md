# Configure Laravel Cache To Use Redis

April 9, 2020 by [Areg Sarkissian](https://aregsar.com/about)

[Configure Laravel Cache To Use Redis](https://aregsar.com/blog/2020/configure-laravel-cache-to-use-redis)

> Note: These are installation instructions for Laravel 7. The post will get updated as needed newer versions of Laravel 

In this article I will show you how to convert the Laravel Cache configuration to use Redis.

By default Laravel uses the file driver to cache data. This will not be performant for high traffic sites.

## Setting the Laravel cache driver

We can change the default Laravel cache store configuration to use the Redis key value store to cache data by changing the 'driver' setting in the `config/cache.php` configuration file.

The `config/cache.php` has a list of stores as defined by the `stors` setting

```php
 'default' => env('CACHE_DRIVER', 'file'),
 'stores' => [
        'redis' => [
            'driver' => 'redis',
            'connection' => 'cache',
        ],
        'file' => [
            'driver' => 'file',
            'path' => storage_path('framework/cache/data'),
        ],

    ],
```

Here I am showing only the file and redis store.

Each store has a driver setting. The file store is set as the default store as defined by the `default` setting and in the `.env` file:

```php
 'default' => env('CACHE_DRIVER', 'file'),
```

```ini
CACHE_DRIVER=file
```

> Note: the `CACHE_DRIVER` environment variable used to set the cache `default` is a misnomer because it indicates that it is the setting for a cache `driver` where in actuality it is setting the cache to a `store` that is one of the stores specified in the `stores` setting. The actual cache driver will be the driver specified within the selected store. I like to change the `CACHE_DRIVER` to `CACHE_STORE` to accurately represent the `default` cache store setting.

All stores have a `driver` setting. The `file` store has a driver setting of `file` and a path setting for the file used to cache data.

The `'redis'` store has a `driver` setting set to `redis` which sets the redis driver to use the `redis` driver specified in `config/database.php`

Unlike the file store, other data stores also have a `connection` setting that is set to the `connection` setting of the `driver` set for the store. The connection setting is specified under for the `driver` in `config/database.php`.

So the `redis` store setting in `config/cache.php` has a `driver` setting set to `redis` and a `connection` setting set to the `cache` connection that is one of the out of the box connections generated by Laravel for the the `redis` driver specified in `config/database.php`.

Snippets of the Redis configurations from both `config/cache.php` and `config/database.php` are shown below:

```php
# config/cache.php
 'default' => env('CACHE_STORE', 'redis'),
 'stores' => [
        'redis' => [
            # uses the redis driver defined in config/database.php
            'driver' => 'redis',
            #uses the 'cache' configuration of the 'redis' driver in config/database.php
            'connection' => 'cache',
        ]
    ],
```

```php
# config/database.php
'redis' => [
        'cache' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'password' => env('REDIS_PASSWORD', null),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_CACHE_DB', '1'),
        ],

    ],
```

## Changing the default cache store to use Redis

To let the Laravel cache facade\provider to use Redis by default we need to change the cache store value of the `default` setting in `config/cache.php`.

So first we need to change the `CACHE_DRIVER` setting in the `.env` file to a `CACHE_STORE` setting environment variable that is set to `redis`:

```ini
CACHE_STORE=redis
```

Then change the `default` setting in `config/cache.php`:

```php
 'default' => env('CACHE_STORE', 'redis'),
```

Alternatively if we always use Redis as the cache, we can remove the environment variable and hard code the setting in `config/cache.php`:

```php
 'default' => 'redis',
```

## Using the Laravel Cache

The snipper below uses the default cache store specified in `config/cache.php`:

```php
$value = Cache::get('foo');
```

select a store from stores specified in config/cache.php

The snipper below explicitly uses a the `file` store specified in `config/cache.php` even though the default cache store is set to `redis` in `config/cache.php`:

```php
$value = Cache::store('file')->get('bar');
```

Note: We can additional cache `redis` stores in `config/cache.php` that are configured to use other `redis` driver connections in `config/database.php`.

Below is an example of adding a `redis2` store to `config/cache.php` that references a `cache2` redis connection added to the `redis` driver in `config/database.php`:


```php
# config/cache.php
 'stores' => [
        'redis' => [
            # uses the redis driver defined in config/database.php
            'driver' => 'redis',
            #uses the 'cache' configuration of the 'redis' driver in config/database.php
            'connection' => 'cache',
        ],
        'redis2' => [
            # uses the redis driver defined in config/database.php
            'driver' => 'redis',
            #uses the 'cache' configuration of the 'redis' driver in config/database.php
            'connection' => 'cache2',
        ]
    ],
```

```php
# config/database.php
'redis' => [
        'cache' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'password' => env('REDIS_PASSWORD', null),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_CACHE_DB', '1'),
        ],
        'cache2' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'password' => env('REDIS_PASSWORD', null),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_CACHE_DB', '1'),
        ],

    ],
```

Given the above settings we can explicitly use the new `redis2` store like so:

```php
$value = Cache::store('redis2')->get('bar');
```
